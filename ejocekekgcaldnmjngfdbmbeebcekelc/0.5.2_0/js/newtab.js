function checkIfArrayHasObject(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return!0;return!1}var app=angular.module("spotsNewtab",["ngRoute","ui.sortable"]);app.config(["$routeProvider","$sceProvider","$compileProvider",function(a,b,c){a.otherwise({redirectTo:"/newtab.html"}),b.enabled(!1),c.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|chrome-extension):/),c.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|chrome-extension):|data:image\/|chrome:\/\/(favicon|extension-icon)/),c.debugInfoEnabled(!1),time.end("App Creation")}]),app.factory("$jQuery",["$q",function(a){function b(a,b){var c=document.createDocumentFragment(),d=a.length,e=function(){0===--d&&b()};a.forEach(function(a){var b=document.createElement("script");b.src=a,b.async=!1,b.onload=e,c.appendChild(b)}),document.head.appendChild(c)}var c=a.defer(),d=["/lib/jquery-2.1.1.min.js","/lib/jquery-ui-1.10.3.custom.min.js"];return _.extend(c.promise,{load:_.once(function(){return b(d,c.resolve),c.promise})})}]),app.directive("lazyBackground",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.lazyBackground);_.each(d,function(c,d){var e,f;b.on("mouseover",function(g){var h=a.$eval(c);h&&h!==f&&(f=h,e=b[0].querySelectorAll(d),jqLite(e).css("background-image","url("+h+")"))})})}}}),app.directive("starRating",function(){return{restrict:"EA",transclude:!1,replace:!0,template:'<div class="rating"><span ng-repeat="i in [1,2,3,4,5]" class="star" ng-class="{ full: $index < rating }"></span></div>',link:function(a,b,c){a.rating=Number(c.starRating).toFixed()}}}),app.directive("spotsLoader",function(){return{restrict:"E",transclude:!1,replace:!0,template:'<object type="application/x-shockwave-flash" data="/img/loaders/loader.swf">  <param name="menu" value="false">  <param name="wmode" value="transparent"></object>'}}),app.directive("ngClickOutside",["$document",function(a){var b;return{restrict:"A",link:function(c,d){c.clickedOutside=function(){b=null},d.bind("click",function(a){b||(b=d);var c=b.find(a.target).length>0;c&&a.stopPropagation()}),a.bind("click",function(){b=null,_.digest(c)})}}}]),app.directive("ngLink",function(){var a,b,c=20;return{restrict:"A",link:function(d,e,f){e.bind("mousedown",function(c){a=c.pageX,b=c.pageY,2==c.which&&c.preventDefault()}),e.bind("mouseup",function(d){Math.abs(a-d.pageX)<c&&Math.abs(b-d.pageY)<c&&(d.currentTarget!=d.target&&d.target.hasAttribute("ng-click")||(1==d.which?(d.preventDefault(),config.favoritesOpenInNewTab?tabs.openLinkInNewTab(f.ngLink):window.location.href=urls.getFullURL(f.ngLink)):2==d.which&&(d.preventDefault(),tabs.openLinkInNewTab(f.ngLink,!1))))})}}}),app.directive("colorPicker",["$timeout",function(a){var b={"default":{defaultColor:"#6D0004",colors:{"#303030":["#021416","#1A282A","#303E40","#465557","#5E6E70"],"#777777":["#352F2B","#4C4540","#645D58","#7E7671","#978F8A"],"#3F00DD":["#00006F","#000084","#1E0098","#3B0DAD","#5424C3"],"#9025FF":["#58009D","#6800B3","#9400D5","#A528ED","#C046FF"],"#FE0B6B":["#BB0071","#DA008B","#F900A5","#FF3AC1","#FF5FDC"],"#FE1C03":["#7C0003","#6D0004","#9C0000","#DE0000","#FF1700"],"#FD6C05":["#A21200","#C23600","#E25200","#FF6B00","#FF892B"],"#FEAB07":["#713400","#8F4C00","#AD6500","#CB7E00","#EB9900"],"#5DA200":["#002800","#003C00","#005500","#1F6E00","#418700"],"#30A700":["#004C00","#006400","#007F00","#169900","#43B500"],"#00A8A9":["#004C51","#006569","#007F82","#009A9C","#00B6B7"],"#009BF0":["#002568","#003981","#00509B","#0068B7","#0082D4"],"#338AFF":["#0023A1","#0037BE","#004DDA","#0064F8","#3B7CFF"]}},light:{defaultColor:"#FF6759",colors:{"#7D8B8C":["#7D8B8C","#96A2A2","#AEB6B8","#BFC4C7","#CED4D4"],"#ADA5A2":["#ADA5A2","#BBB6B3","#CBC7C4","#D6D2CF","#E1DDDC"],"#7750CF":["#7750CF","#906FD8","#A891E1","#BBA6E7","#CBBDEE"],"#CD6BFE":["#CD6BFE","#D686FF","#DFA2FF","#E5B5FF","#ECC6FF"],"#FF7FE3":["#FF7FE3","#FE97E8","#FFAFEE","#FFBFF1","#FFD0F4"],"#FF4634":["#FF4634","#FF6759","#FF8B7E","#FFA29A","#FFB8B2"],"#FEA154":["#FEA154","#FEB276","#FEC496","#FFD0AA","#FFDCC0"],"#D89834":["#D89834","#DFAC59","#E6BE80","#ECCC9B","#F1D9B3"],"#679F32":["#679F32","#83B159","#A0C37F","#B2CF99","#C6DBB2"],"#68C433":["#68C433","#85CE58","#A2DA7F","#B3E199","#C6E9B1"],"#33C5C5":["#33C5C5","#59CFCF","#7FDADB","#98E2E1","#B2EAE9"],"#339ADD":["#339ADD","#59AEE4","#7FC0E8","#98CDED","#B1D9F2"],"#6196FE":["#6196FE","#80AAFF","#9EBDFE","#B1CBFE","#C4D7FF"]}},favorites:{defaultColor:"#819799",colors:{"#0FA593":["#00905B","#3EB984","#0FA593","#33C5C5","#7CCB4D"],"#6296FF":["#39579A","#2570E8","#0082D4","#6296FF","#3A96FF"],"#833BC7":["#6419BC","#833BC7","#CD6BFF","#C046FF","#AC7CDA"],"#333333":["#333333","#666666","#819799","#99918D","#999999"],"#FF1542":["#9B1313","#F10025","#C7346D","#FF1542","#F7667C"],"#F2C406":["#B78236","#EFA30C","#D6A300","#FFCE00","#F2C406"],"#FF6D00":["#D17835","#A04525","#EA5F00","#FF6D00","#FF8533"]}}};return{restrict:"AE",require:"ngModel",template:'<div class="color-picker-component"><div class="family"><div class="family-color" ng-repeat="(family, colors) in colorSet track by $index" ng-style="{background:family}" ng-class="{selected:family==currentFamily}" ng-click="pickFamily(family, true)"></div></div><div class="arrow"></div><div class="colors"><div class="color" ng-repeat="color in colorSet[currentFamily] track by $index" ng-style="{background:color}" ng-class="{selected:color==currentColor}" ng-click="pickColor(color)"></div></div></div>',scope:{ngModel:"=",colorScheme:"@",addColors:"=",ngChange:"&"},link:function(c,d){var e,f=$(".color-picker-component",d),g=$(".arrow",f),h=$(".colors",f);c.pickFamily=function(b,d){c.currentFamily=b,c.colorSet[b]||(c.colorSet[b]=[b]),d&&(c.currentColor=c.colorSet[b][Math.floor(c.colorSet[b].length/2)],c.ngModel=c.currentColor),a(function(){var a=$(".family-color.selected",f),b=$(".family",f).width();if(a.position())var c=a.position().left+a.width()/2;var d=h.width(),e=_.keepWithinRange(c-d/2,0,b-d);g.css("left",c-7),h.css("left",e)})},c.addColorsHandler=function(a){_.size(a)&&(c.colorSet=angular.copy(e.colors),_.extend(c.colorSet,a),c.ngModel&&c.pickColor(c.ngModel))},c.pickColor=function(b,d){if(d){b=String(b).toLowerCase();var e=!1;if(_.each(c.colorSet,function(a,d){_.each(a,function(a){b==String(a).toLowerCase()&&(e=!0,c.pickFamily(d,!1),c.currentColor=a,c.ngModel=c.currentColor,c.ngChange())})}),!e){var f={};f[b]=[],async.eachSeries([.6,.8,1,1.2,1.4],function(a,c){graphicAssets.colorLuminance(b,a,function(a){f[b].push(a),c()})},function(){c.addColorsHandler(f),a(function(){c.pickColor(b,!0)})})}}else c.currentColor=b,c.ngModel=c.currentColor,c.ngChange()},c.$watch("addColors",c.addColorsHandler,!0),c.$watch("ngModel",function(a){a&&c.pickColor(a,!0)}),e=b[c.colorScheme?c.colorScheme:"default"],c.colorSet=angular.copy(e.colors),c.ngModel||c.pickColor(e.defaultColor,!0)}}}]),app.directive("fallbackSrc",function(){return{link:function(a,b,c){b.bind("error",function(){$(this).attr("src",c.fallbackSrc)})}}}),app.directive("errorClass",function(){return{link:function(a,b,c){b.bind("error",function(){angular.elem(this).addClass(c.errorClass)})}}}),app.directive("backgroundUrl",function(){return{link:function(a,b,c){c.$observe("backgroundUrl",function(a){b.css({"background-image":a?"url("+a+")":"none"})})}}}),app.directive("fallbackBg",function(){return{link:function(a,b,c){$(b).bind("error",function(){$(b).css({"background-image":"url("+c.fallbackSrc+")"})})}}}),app.directive("contact",function(){return{restrict:"E",scope:{contact:"=",badges:"=",hideName:"=",themeColor:"="},template:'<div class="contact-component" ng-style="contactStyle" ng-class="{noimage:noImage}" ng-click="ngClick"><span ng-show="name" class="name">{{ name }}</span><span ng-if="badges && badges > 0" class="badge" ng-style="badgeStyle">{{ badges }}</span></div>',link:function(a,b,c){a.updateView=function(){if(a.contactStyle={},a.badgeStyle={background:config.accentColor},a.themeColor&&(a.contactStyle["background-color"]=config.themeColor),a.noImage=!1,a.badges&&(a.badges=parseInt(a.badges,10)),a.badges&&a.badges>0&&(a.contactStyle["box-shadow"]="0 0 0 3px "+config.accentColor+" inset"),a.contact){if(a.name=a.hideName?null:a.contact.display,a.hideName||_.isEmpty(a.contact.display)?a.noImage=!0:a.contact.display&&(a.name=a.contact.display),a.contact.image){var b=$("<img />").attr("src",a.contact.image);b.load(function(){a.contactStyle["background-image"]="url("+a.contact.image+")",a.contactStyle["background-color"]=null,a.noImage=!1,a.name=null,_.digest(a)})}}else a.noImage=!0},a.$watch("contact",a.updateView),a.$watch("badges",a.updateView)}}}),app.directive("autocompletePlaces",function(){return{restrict:"A",scope:!0,link:function(a,b,c){function d(){var b={},d=a.$eval(c.autocompletePlaces);return d&&(d.types&&(b.types=[d.types]),d.bounds&&(b.bounds=d.bounds),d.country&&(b.componentRestrictions={country:d.country})),b}function e(){a.gPlace=new google.maps.places.Autocomplete(b[0],d()),google.maps.event.addListener(a.gPlace,"place_changed",function(){a.$emit("placeSelected",a.gPlace.getPlace(),b.val())})}window.google&&google.maps&&google.maps.places?e():(window.googlePlacesLoaded=_.once(function(){a.$emit("GooglePlacesLoaded"),e()}),$.getScript("https://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&callback=googlePlacesLoaded&language="+languageManager.getSelectedLang()))}}}),app.directive("clearButton",function(){return{restrict:"A",scope:!0,link:function(a,b,c){var d=$("<span class='input-clear-button'>&times;</span>").on("click",function(){a.$eval(c.clearButton),b.val("")});b.wrap("<div>").after(d).on("keyup",function(a){27===a.keyCode&&""!==b.val()&&(d.click(),a.stopPropagation())})}}}),app.directive("autoResize",function(){return{restrict:"A",transclude:!0,link:function(a,b,c){var d=b[0];b.attr("rows",c.rows||1).css("box-sizing","border-box"),a.$watch(c.ngModel,function(){d.style.height="auto",d.style.height=d.scrollHeight+d.offsetHeight-d.clientHeight+"px"})}}}),app.directive("spot",["$filter",function(a){return{restrict:"AE",scope:{item:"=",opentab:"=",colorAutoBalance:"&",size:"="},template:'<div id="{{iconId}}" class="spot-component" ng-style="spotStyle"><span ng-show="!item.userIcon">{{ title }}</span></div>',compile:function(){function b(b){b.title=null,b.spotStyle={width:b.size.toString()+"px",height:b.size.toString()+"px","background-color":b.item.color,"background-size":b.item.iconSize?100*b.item.iconSize+"%":null},b.iconId=b.item.userIcon&&b.item.userIcon.replace(/^.*[\\\/]/,"").replace(".",""),b.item.userIcon?(b.spotStyle["background-image"]="url("+b.item.userIcon+")",b.opentab&&b.item.userIcon.indexOf("app/spots")&&(b.spotStyle["background-image"]="url("+b.item.userIcon+")")):b.item.icon?(b.spotStyle["background-image"]="url("+b.item.icon+")",b.opentab&&b.item.icon.indexOf("app/spots")&&(b.spotStyle["background-image"]="url("+(/https?:\/\//i.test(b.item.icon)?"":paths.base)+b.item.icon+")")):(b.title=a("spotIconLetters")(b.item),b.spotStyle["font-size"]=Math.round(.45*b.size),graphicAssets.contrastFilter(b.item.color,.7,function(a){b.spotStyle.color=a})),_.digest(b)}return function(a,c,d){a.item=a.item?a.item:{},a.$watchCollection("[item.id, item.iconSize, item.userIcon, item.icon, item.color, size]",b.bind(null,a))}}}}]),app.directive("fileUpload",["$timeout","$rootScope",function(a,b){return{restrict:"A",scope:{folder:"=",maxSize:"=",createThumbnail:"=",maxWidth:"=",maxHeight:"=",partial:"=",item:"=",noUser:"&",isOpentab:"="},template:'<span ng-include="partial"></span><input ng-show="false" type="file" name="file" accept="image/*"/>',link:function(c,d){c.i18n=b.i18n,c.percent=0,c.math=window.Math,c.themeColor=config.themeColor,c.input=$(d).find("input[type='file']"),c.s3BaseUrl=config.s3_images_folder,c.images=[],c.thumbnails={},c.thumbnailsFolder=[c.folder,"thumbnails"].join("/"),c.maxUploadTime=500,c.updateImages=function(){S3.list(c.folder,20,function(a){a instanceof Error||(a=_.groupBy(a,function(a){return a.Key.indexOf("thumbnails")>=0?"thumbnails":"images"}),a.thumbnails=_.object(_.map(a.thumbnails,function(a){return c.getFilename(a.Key)}),_.pluck(a.thumbnails,"Key").map(function(a){return c.s3BaseUrl+a})),c.thumbnails=_.extend(a.thumbnails,c.thumbnails),c.images=_.sortBy(a.images,"LastModified").map(function(a){return a.FileName||(a.FileName=c.getFilename(a.Key)),a}),_.digest(c))})},c.updateImages(),c.validateImageDimensions=function(a,b){var d=new FileReader;d.onload=function(a){var d=new Image;d.src=a.target.result;var e=c.maxWidth?d.width<=c.maxWidth:!0,f=c.maxHeight?d.height<=c.maxHeight:!0;b(e&&f,d)},d.readAsDataURL(a)},c.getFilename=function(a){return a?a.split("/").pop():null},c.uploadThumbnail=function(a,b){graphicAssets.resizeImage(a,280,null,function(d){c.thumbnails[c.getFilename(b)]=d,c.latestThumbnail=d,_.digest(c);var e=graphicAssets.toBlob(d);e.name=a.name,S3.uploadImage(e,{filename:e.name,folder:c.thumbnailsFolder},{success:function(){c.latestThumbnail=null}})})},c.finishUploading=function(b){c.increasePercent(100),c.$apply("percent"),a(function(){c.selectImage(b,!0),c.updateImages(),c.$parent.$$phase||c.$parent.$apply("config"),c.resetUploader()},100)},c.increasePercent=function(a){c.percent=a,_.digest(c)},c.upload=function(b,e){$(".favorites-image-upload",d).css({height:15,margin:"10px 0"}),_.whenOnline(function(){var d=(new Date).getTime(),f=a(function(){c.increasePercent(20)},.2*c.maxUploadTime),g=a(function(){c.increasePercent(40)},.4*c.maxUploadTime),h=a(function(){c.increasePercent(60)},.6*c.maxUploadTime),i=a(function(){c.increasePercent(80)},.8*c.maxUploadTime),j=a(function(){c.increasePercent(90)},.9*c.maxUploadTime),k=a(function(){c.increasePercent(95)},.95*c.maxUploadTime);S3.uploadImage(b,{filename:e||b.name,folder:c.folder,maxSize:c.maxSize},{success:function(b){var e=(new Date).getTime();if(d<e+c.maxUploadTime){var f=d+c.maxUploadTime-e;a(function(){c.finishUploading(b)},f)}else c.finishUploading(b)},error:function(b,d){c.percent=-1,a.cancel(f),a.cancel(g),a.cancel(h),a.cancel(i),a.cancel(j),a.cancel(k),c.resetUploader()},progress:function(a,d){null===a&&c.createThumbnail&&c.uploadThumbnail(b,d)}})}())},c.selectImage=function(a,b){(c.$parent.selectImage||$.noop)(a,c.folder,b)},c.removeImage=function(a,b){var d=c.getFileName(a);(c.$parent.removeImage||$.noop)(a),c.item&&c.item.userIcon&&(c.item.userIcon=null),S3.deleteFile(c.folder,d,null),c.createThumbnail&&S3.deleteFile(c.thumbnailsFolder,d,null),b&&b.stopPropagation()},c.selectFile=function(){config.user?c.input.show().click().focus():c.noUser()},c.input.on("keyup",function(a){27===a.keyCode&&(c.input.blur().hide(),a.stopPropagation())}),c.resetUploader=function(){$(".favorites-image-upload",d).css({height:40,margin:"0"}),c.percent=0,c.latestThumbnail=null,c.input.val(""),_.digest(c)},c.getIconId=function(a){return a.replace(/^.*[\\\/]/,"").replace(".","")},c.getFileName=function(a){return a.replace(/^.*[\\\/]/,"")},c.input.on("change",function(){c.increasePercent(5);var a=c.input[0].files[0];c.validateImageDimensions(a,function(b,d){b?(c.selectImage(d.src),c.upload(a)):graphicAssets.resizeImage(d,c.maxWidth,c.maxHeight,function(b){c.selectImage(b),c.upload(b,a.name)})})})}}}]),app.directive("rowsCalculator",function(){return{restrict:"A",link:function(a,b,c){var d=_.throttle(function(){var d=Number(c.rowsCalculator),e=b[0].querySelectorAll(".item")[0],f=window.getComputedStyle(e),g=Number.parseFloat(f.width);"border-box"===f.boxSizing&&(g-=Number.parseFloat(f["padding-right"]),g-=Number.parseFloat(f["padding-left"])),a.itemLimit=Math.floor(b[0].offsetWidth/g)*d,_.digest(a)},50);a.$watch(c.itemsArray,function(b){b&&b.length&&a.$evalAsync(d)}),jqLite(window).on("resize",d)}}}),app.filter("fromNow",[function(){return function(a){return moment(parseInt(a,10)).fromNow()}}]),app.filter("dayOfWeek",[function(){return function(a){return moment(parseInt(a,10)).format("dddd")}}]),app.filter("formatDate",[function(){return function(a){return moment(a).format(config.dateFormat||"l").replace(/\//g,".")}}]),app.filter("Math",[function(){return function(a,b){return Math[b](a)}}]),app.filter("spotIconLetters",["$cacheFactory",function(a){var b=a("spotIconLetters");return function(a){if(_.isObject(a)&&(a=a.title||a.url&&urls.getHostName(a.url,!0)),_.isString(a)){var c=a+"_"+config.favoritesLetterCount;if(!b.get(c)){var d=a.substr(0,config.favoritesLetterCount);b.put(c,d)}return b.get(c)}}}]),app.filter("hexToRgba",[function(){return _.memoize(function(a,b){return graphicAssets.hexToRgba(a,b)},function(a,b){return[a,b].join("_")})}]),app.filter("normalizePhoneNumber",function(){return"contacts"in window?contacts.normalizePhoneNumber:String}),app.filter("cleanURL",[function(){return _.memoize(function(a){return urls.getHostName(a,!0)})}]),app.filter("tempetureUnit",function(){return function(a){if("fahrenheit"==config.temperatureUnit){var b=9*parseInt(a,10)/5+32;return Math.round(b)}return a}}),app.filter("contrastFilter",function(){return function(a){var b=graphicAssets.contrastFilter(a,.9);return"#ffffff"==b?a:b}}),app.controller("NewtabMainCtrl",["$scope","$rootScope","$timeout","$templateCache","$jQuery",function(a,b,c,d,e){"use strict";time.end("MainCtrl"),time.start("MainCtrl-rendering"),c(function(){time.end("MainCtrl-rendering"),bi.report({event_name:"ntview"})}),b.i18n=languageManager.getLangObj(),b.$on("SETTINGS_LANGUAGE_CHANGED",function(a,c){moment.lang(c.langName),b.i18n=c.obg,_.digest(b)}),backgroundPage.newtabs[tabID]={app:app,mainScope:a,timeout:c,window:window},eventManager.addScope(tabID,function(){b.$broadcast.apply(b,arguments)}),modalManager.checkModals(),jqLite(document).on("keyup",function(b){27==b.keyCode&&a.modalPath&&(a.closeModal(),_.digest(a))}),a.config=config,a.configAPI=configAPI,a.window=window,d.put("Empty.html",""),a.isEmpty=_.isEmpty,b.jQueryLoaded=!1,a.loaded=_.once(function(){a.$evalAsync(function(){time.end("Newtab Loaded_"+window.tabID,!0)}),e.load().then(function(){b.jQueryLoaded=!0,_.digest(a)})}),a.getHostName=function(a){return urls.getHostName(a,!0)},a.googleLoginPopup=function(){_gaq.push(["_trackEvent","Login","google","Start"]),backgroundPage.login.type="goog",bi.report({event_name:"login",login_type:backgroundPage.login.type,login_src:backgroundPage.login.src,login_result:"start"});var a=600,b=450;window.open(config.url_api+"/auth/google?uuid="+config.uuid,"Google Login","width="+a+",height="+b+",screenX="+(window.screen.width/2-a/2)+",screenY="+(window.screen.height/2-b/2))},a.facebookLoginPopup=function(a){_gaq.push(["_trackEvent","Login","facebook","Start"]),backgroundPage.login.type="fb",bi.report({event_name:"login",login_src:backgroundPage.login.src,login_type:backgroundPage.login.type,login_result:"start"});var b=600,c=450,d=config.url_api+"/auth/facebook?";a||(d+="uuid="+config.uuid),window.open(d,"Facebook Login","width="+b+",height="+c+",screenX="+(window.screen.width/2-b/2)+",screenY="+(window.screen.height/2-c/2))},e.then(function(){b.modalHandlers={onClose:$.Callbacks(),onLoginSuccess:$.Callbacks(),onLoginError:$.Callbacks()},a.loginSuccessHandler=function(){b.closeModal(!1),b.modalHandlers.onLoginSuccess.fire().empty()},a.loginErrorHandler=function(){a.message={text:"An error occurred while trying to login, Please restart your browser and try again. if the problem still exits please try a different identity provider.","class":"alert-danger"},a.$apply(),configAPI.set("guid",null),configAPI.set("token",null),configAPI.set("user",null)},a.tokenExpiredHandler=function(){user.logout(),b.openModal(null,"/app/newtab/partials/modals/tokenExpiredModal.html")},b.$on("CONFIG_USER_LOGIN_SUCCESS",a.loginSuccessHandler),b.$on("CONFIG_USER_LOGIN_ERROR",a.loginErrorHandler),b.$on("CONFIG_USER_TOKEN_EXPIRED",a.tokenExpiredHandler)}),a.getUserImage=function(){return config?config.user&&config.user.fbid?"https://graph.facebook.com/"+config.user.fbid+"/picture":config.fbAccessToken?"https://graph.facebook.com/me/picture?access_token="+config.fbAccessToken:config.user.gpicture?config.user.gpicture:null:null},a.gae=function(a,b,c,d){_gaq.push(["_trackEvent",a,b,c],d)},a.getAndroidApp=function(c){_gaq.push(["_trackEvent","Android Notification","Open"]),a.playUtilsAppID=c,b.openModal("android_app","/app/newtab/partials/modals/AndroidAppModal.html")},a.closeInstalledAndroidApp=function(){_gaq.push(["_trackEvent","Android Notification","Close"]),configAPI.set("InstalledAndroidAppCloseDate",(new Date).getTime())},a.getiOSApp=function(c){a.playUtilsAppID=c,b.openModal("ios_app","/app/newtab/partials/modals/iOSAppModal.html")},a.$watchCollection(function(){return[config.bgColor,config.bgImage,config.bodyClass]},function(){a.bodyStyle={"background-image":config.bgImage?"url("+config.bgImage+")":null,"background-color":config.bgColor},a.bodyClass=config.bodyClass;var b="clean"==config.bodyClass?"#ffffff":config.themeColor;if(a.navBarStyle={"background-color":graphicAssets.hexToRgba(b,config.navbarOpacity,null)},"clean"==config.bodyClass){var c=graphicAssets.hexToRgba("#E9E9E9",config.navbarOpacity,null);a.navBarStyle["border-bottom-color"]=c,a.navBarColStyle={"border-right-color":c}}})}]),app.controller("NavbarCtrl",["$scope",function(a){"use strict"}]),app.controller("NavbarUserPanelCtrl",["$scope","$rootScope",function(a,b){"use strict";b.feedbackHandler=function(){b.openModal("leave_us_a_feedback","/app/newtab/partials/modals/FeedbackModal.html",null,null),a.gae("User-Menu","Feedback","Click")},a.setLoginSource=function(){backgroundPage.login.src="loginbutton"}}]),app.controller("NavbarSearchCtrl",["$scope","$rootScope","$timeout","$spotsManager","$search","$window","$jQuery",function(a,b,c,d,e,f,g){"use strict";function h(){var b=a.results[a.searchTerm];a.selectedItem++,b&&(a.selectedCategory>=b.length&&(a.selectedCategory=0,a.selectedItem=0),a.selectedItem>=b[a.selectedCategory].results.length&&(a.selectedCategory++,a.selectedItem=0,a.selectedCategory===b.length&&h()),b[a.selectedCategory]&&!b[a.selectedCategory].results[a.selectedItem].show&&h())}function i(){var b=a.results[a.searchTerm];a.selectedItem--,a.selectedItem<0&&(a.selectedCategory--,a.selectedCategory<0&&(a.selectedCategory=b.length-1),a.selectedItem=b[a.selectedCategory].results.length-1,a.selectedItem<0&&i()),b[a.selectedCategory]&&!b[a.selectedCategory].results[a.selectedItem].show&&i()}var j;a.results={},a.searchTerm=null,a.selectedCategory=0,a.selectedItem=0,a.Math=f.Math,a.enterEventInfo=null,a.searchKeyHandler=function(b){switch(b.keyCode){case 40:a.searchTerm&&a.results[a.searchTerm].length&&h();break;case 38:a.searchTerm&&a.results[a.searchTerm].length&&(i(),a.selectRange(b.target,a.searchTerm.length,a.searchTerm.length));break;case 13:a.searchTerm&&(a.results[a.searchTerm].length?a.enterEventInfo={spotID:a.results[a.searchTerm][a.selectedCategory].spotID,type:a.results[a.searchTerm][a.selectedCategory].type,selectedItem:a.selectedItem}:a.resultClick(a.buildGoogleSearchURL(a.searchTerm)));break;case 27:a.searchTerm=null}},a.resultsLimit=Math.floor((f.innerHeight-80)/50),angular.element(f).bind("resize",_.debounce(function(){var b=Math.floor((f.innerHeight-80)/50);b!=a.resultsLimit&&(a.resultsLimit=b,a.calculateVisibleResults(),a.$apply("resultsLimit"))},100)),a.$watch("searchTerm",function(d){b.searchTerm=d,a.searchQueryInPreviousResults(function(){c.cancel(j),a.enterEventInfo=null,!d||a.results[d]&&a.results[d].length||(a.results[d]=a.tempResults?a.tempResults:[],j=c(function(){e.search(d,a.searchResponseHandler)},200))})}),b.setSearchTerm=function(b){a.searchTerm=b},a.searchQueryInPreviousResults=function(b){if(a.LastSearchCommited&&a.searchTerm){var c=a.searchTerm,d=a.getSearchRegex(c);a.tempResults=angular.copy(a.results[a.LastSearchCommited]),_.each(a.tempResults,function(b){b.results=_.filter(b.results,function(b){return a.checkFields(b,["givenName","familyName","display","title","url","name","shortName","label"],d)})}),a.tempResults=_.reject(a.tempResults,function(a){return 0===a.results.length}),b()}else b()},a.checkFields=function(a,b,c){var d;return _.each(b,function(b){!_.isUndefined(a[b])&&c.test(a[b])&&(d=!0)}),d},a.getSearchRegex=function(a){return a?(a.length<3&&(a="^"+a),a=a.replace(" ","\\s"),new RegExp(a,"i")):void 0},a.searchResponseHandler=function(b){b.results.length&&(a.results[b.query]||(a.results[b.query]=[]),a.results[b.query]=_.reject(a.results[b.query],function(a){return a.spotID==b.spotID&&a.type==b.type}),a.results[b.query].push(b),a.results[b.query]=_.sortBy(a.results[b.query],function(a){return-1*a.priority}),a.calculateVisibleResults(),a.results[b.query]=_.sortBy(a.results[b.query],function(a){return-1*a.priority})),a.selectedCategory=0,a.selectedItem=0,a.LastSearchCommited=b.query,a.$$phase||a.$apply()},a.calculateVisibleResults=function(){var b=[];_.each(a.results[a.searchTerm],function(c,d){a.results[a.searchTerm][d].results=_.sortBy(c.results,function(a){return-1*a.score}),b=_.union(b,c.results)}),_.each(b,function(b,c){b.show=c<a.resultsLimit})},a.setSelected=function(b,c){a.selectedCategory=b,a.selectedItem=c},a.spotsById=function(a){return d.getSpotByID(a)},a.resultClick=function(a){var b=_.isString(a)?a:a.url||a.link;b&&($("html").addClass("spots-web-hider"),window.location.href=urls.getFullURL(b))},a.selectRange=function(a,b,c){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,c);else if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d.select()}},a.buildGoogleSearchURL=function(a){return config.searchProviderUrl+a},a.googleSearch=function(){a.searchTerm&&(_gaq.push(["_trackEvent","Search","Web-Search","Search-Btn-Click"]),_gaq.push(["_trackEvent","Search-Term",a.searchTerm,""]),bi.report({event_name:"srch",srch_provider:urls.getBaseDomain(config.searchProviderUrl).split(".").pop()}),window.location.href=a.buildGoogleSearchURL(a.searchTerm))}}]),app.controller("NavbarNotificationsCtrl",["$scope","$notificationManager","$timeout",function(a,b,c){"use strict";var d;a.selected=0,a.notifications=[],a.notificationPartials=b.notificationPartials,a.notificationWidgets=b.notificationWidgets,b.getAll({newtab:!0},function(b){a.notifications=b,a.selectItem(0),_.digest(a)}),a.$on("NOTIFICATIONS_NOTIFICATION_ADDED",function(b,c){c.newtab&&(a.notifications.unshift(c),a.selected=0,_.digest(a))}),a.$on("NOTIFICATIONS_NOTIFICATION_CLEARED",function(b,c){a.notifications=_.filter(a.notifications,function(a){return a.id!=c.id}),a.selected>=a.notifications.length&&(a.selected=a.notifications.length-1),_.digest(a)}),a.$on("NOTIFICATIONS_ALL_NOTIFICATIONS_CLEARED",function(){a.notifications=[],_.digest(a)}),a.removeNotification=function(c){a.reportNotification(c,"close"),c.type&&_gaq.push(["_trackEvent","Notifications",c.type,"Close"]),a.notifications=_.filter(a.notifications,function(a){return a.id!=c.id}),_.digest(a),b.clear(c.id,null)},a.autoRotate=function(){a.selected++,a.selected>=a.notifications.length&&(a.selected=0),_.digest(a),d=c(function(){a.autoRotate()},config.notificationNewtabAutoRotate)},a.selectItem=function(b){a.selected=b,b>=a.notifications.length?a.selected=a.notifications.length-1:0>b&&(a.selected=0),_.digest(a),c.cancel(d),d=c(function(){a.autoRotate()},config.notificationNewtabAutoRotate)},a.reportNotification=function(a,b){var c={"Facebook-Birthday":"fbbirthday","Facebook-Event":"fbevent"};bi.report({event_name:"notification",notification_type:c[a.type],notification_useraction:b})},function(){var b=null;a.selectedWidgetIndex=0,a.selectWidget=function(d){d>=a.notificationWidgets.length&&(d=0),c.cancel(b),a.selectedWidgetIndex=d,b=c(function(){a.selectWidget(a.selectedWidgetIndex+1)},config.notificationNewtabAutoRotate)}}()}]),app.controller("NavbarPhoneCtrl",["$scope","$rootScope","$q","$contacts","$sms","$timeout","$pushService","$spotsManager","$notificationManager","$user",function(a,b,c,d,e,f,g,h,i,j){"use strict";b.phoneOpen=!1,a.selectedThread=null,a.showAllThreads=!1,a.userContact=j.userContact(),a.isLoginHidden=config.hideLogin,a.hideLogin=function(){a.isLoginHidden=!0,configAPI.set("hideLogin",!0)};var k=h.spotID("contacts"),l=h.spotID("call_log"),m=h.spotID("sms"),n=$("#navPhone");$(".select-contact").keyup(function(b){a.searchResults&&(a.resultsLimit=5,a.resultSetLength=a.dataArray.length,a.contactSearchTerm||(a.selected=0),40==b.keyCode?(a.selected++,a.contactSearchTerm&&a.selected>a.resultSetLength-1&&(a.selected=0)):38==b.keyCode?(a.contactSearchTerm&&$("input.contact-text",n).selectRange(a.contactSearchTerm.length,a.contactSearchTerm.length),a.selected--,a.selected<0&&(a.selected=a.contactSearchTerm?a.resultSetLength-1:0)):13==b.keyCode?a.resultClick($("ul.contact-numbers > li.selected").text().trim()):27==b.keyCode&&a.closeSearch(),a.$$phase||a.$apply("selected"))}),a.onEnter=function(b){switch(b.keyCode){case 13:!b.shiftKey&&a.smsText.trim()&&(a.sendMessage(),b.preventDefault());break;case 27:a.smsText.trim()?(a.smsText="",_.digest(a),b.stopPropagation()):a.closePhone()}},a.scrollToView=function(){f(function(){$(".thread-data-container").each(function(){this.scrollTop=this.scrollHeight}),$("#send-sms-block").focus()})},a.init=function(){a.$on("NOTIFICATIONS_NOTIFICATION_ADDED",a.notificationEventReceived),a.$on("NOTIFICATIONS_NOTIFICATION_CLEARED",a.notificationEventReceived),a.$on("NOTIFICATIONS_ALL_NOTIFICATIONS_CLEARED",a.notificationEventReceived),a.$on("MAGIC_ITEM_UPDATED",a.magicUpdatedEventReceived),a.$on(h.spotID("contacts")+"_CACHE_UPDATE",a.updateTopContacts),a.updateTopContacts(),a.$watch("selectedThread",function(){a.selectedThread&&(a.threadData={thread:a.selectedThread,contact:a.getContactByPhoneNumber(a.selectedThread),data:null},e.getThreadForNumber(a.selectedThread,function(b){a.threadData.data=b,a.$$phase||a.$apply("threadData"),a.scrollToView(),f(function(){e.clearNotificationsForNumber(a.selectedThread)},ONE_SECOND)}))})},a.magicUpdatedEventReceived=function(b,c){c==k&&a.updateTopContacts()},a.notificationEventReceived=function(b,c){if(c){var d=c.spotID;(d==l||d==m)&&a.updateTopContacts()}},a.updateTopContacts=function(){d.getTopMagicResults(3,function(b){i.getAll({spotID:h.spotID("sms")},function(c){a.topContacts=[],_.each(b,function(b,e){var f=b.objectID,g=d.getContactByPhoneNumber(f);g||(g={display:"Unknown",givenName:"Unknown"});var h=_.filter(c,function(a){return a.data.number==f});g.badges=h.length,g.number=f,g.score=b.score,a.topContacts.push(g)}),_.size(a.topContacts)>0&&configAPI.set("InstalledAndroidApp",!0),a.$$phase||a.$apply("topContacts")})})},$.fn.selectRange=function(a,b){return b||(b=a),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(a,b);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}})},a.sendMessage=function(){_gaq.push(["_trackEvent","Phone-Nav-Bar","Send-Message","Click"]);var b=a.selectedThread,c=a.smsText.trim();a.threadData.data.push({id:(new Date).getTime(),number:b,text:c,timestamp:(new Date).getTime().toString(),type:3}),g.sendNotification(h.spotID("sms"),1,{number:b,text:c},function(){}),a.smsText="",_.digest(a),a.scrollToView()},a.callContact=function(){_gaq.push(["_trackEvent","Phone-Nav-Bar","Call-Contact","Click"]),a.currentView="calling",g.sendNotification(h.spotID("call_log"),1,{number:a.selectedThread,speaker:config.phoneSpeaker},function(){})},a.cancelCall=function(){_gaq.push(["_trackEvent","Phone-Nav-Bar","Call-Contact","Cancel"]),g.sendNotification(h.spotID("call_log"),2,"",function(){a.currentView="default",_.digest(a)})},a.$on(h.spotID("call_log")+"_4",function(){a.currentView="call_connected",f(function(){a.currentView="default"},5e3)}),a.newConversation=function(){_gaq.push(["_trackEvent","Phone-Nav-Bar","New-Conversation","Click"]),a.threads=!1,a.selectContact=!0,a.contactSearchTerm=null,a.searchResults=null,f(function(){$("#contact-search-box").focus()})},a.$watch("contactSearchTerm",function(b){a.updateSearch()}),a.getResultsLayout=function(){a.searchResults=_.sortBy(a.searchResults,function(a){
return-1*a.priority}),a.dataArray=[],_.each(a.searchResults,function(b,c){var d=0;_.each(b.phones,function(b){a.dataArray.push({index:c+"_"+d++,number:b})})})},a.updateSearch=_.debounce(function(){a.contactSearchTerm&&(a.selected=0,a.contactSearchTerm=a.contactSearchTerm.replace(/^\s\s*/,"").replace(/\s\s*$/,""),a.isFirst=!0,a.searchResults=[],d.search(a.contactSearchTerm,10,function(b){a.searchResults=_.union(a.searchResults,b.results),a.getResultsLayout(),a.$$phase||a.$apply("searchResults")}))},500),a.setSelected=function(b){_.each(a.dataArray,function(c,d){c.index==b&&(a.selected=d)})},a.resultClick=function(b){a.showThread(b)},a.$on(h.spotID("sms")+"_SMS_EVENT",function(b,c){_.each(c,function(b){b.number==a.selectedThread&&a.threadData?(_.each(a.threadData.data,function(c,d){c.text==b.text&&3==c.type&&a.threadData.data.splice(d,1)}),a.threadData.data.push(b),a.$$phase||a.$apply("threadData")):a.showAllThreads&&a.threads&&(_.where(a.threads,{number:b.number}).length>0?a.getPreviousThreads(0,a.threads.length):a.getPreviousThreads(0,a.threads.length+1)),a.scrollToView()})}),b.toggleThread=function(c){a.gae("Phone-Nav-Bar","Top-Contact","Click"),c==a.selectedThread&&b.phoneOpen?a.closePhone():b.showThread(c)},b.showThread=function(c){a.currentView="default",b.phoneOpen=!0,a.showAllThreads=!1,a.selectedThread=c},a.toggleAllThreads=function(){a.gae("Phone-Nav-Bar","Recent-Messages","Click"),b.phoneOpen&&!a.selectedThread?a.closePhone():(b.phoneOpen=!0,a.selectedThread=null,a.showAllThreads=!0,a.getPreviousThreads(0,11))},sms.getAllThreads(function(b){a.totalThreadsCount=b?b.length:0}),a.getPreviousThreads=function(b,c){e.getPreviousThreads(b,c,function(c){i.getAll({spotID:spotsManager.spotID("sms")},function(d){_.each(c,function(b,d){c[d].contact=a.getContactByPhoneNumber(b.number)}),d&&_.each(c,function(a,b){var e=_.filter(d,function(b){return b.data.number==a.number});c[b].badges=e.length}),0===b?a.threads=c:a.threads=a.threads.concat(c),a.$$phase||a.$apply("threads")})})},a.closePhone=function(){b.phoneOpen&&(a.selectedThread=null,a.showAllThreads=!1,b.phoneOpen=!1)},a.getContactDefaultPhone=function(a){return d.getContactDefaultPhone(a)},a.getContactByPhoneNumber=function(a){return d.getContactByPhoneNumber(a)},a.init()}]),app.controller("NewtabModalCtrl",["$scope","$rootScope","$timeout","$jQuery",function(a,b,c,d){"use strict";function e(){var a=$(".modal-content input:first");a.length>0?a.focus():10>f&&(f++,c(e,10))}var f=0;b.openModal=function(c,d,g,h){(h||!a.modalPath)&&(_.each(b.modalHandlers,function(a,b){a.empty(),_.isObject(g)&&a.add(g[b])}),a.modalTitle=c,a.modalPath=d,f=0,e())},b.closeModal=function(c){c=_.isUndefined(c)?!0:!!c,a.modalTitle=null,a.modalPath=null,c&&b.modalHandlers.onClose.fire(),b.modalHandlers.onClose.empty(),_.digest(a)},b.$on("MODAL_OPEN_MODAL",function(a,c){b.openModal(c.title,c.path,c.handlers,!0)}),b.$on("MODAL_CLOSE_MODAL",function(){b.closeModal(!1)}),d.then(function(){$(document).keyup(function(c){27==c.keyCode&&a.modalPath&&(b.closeModal(),a.$apply())})})}]),app.controller("AboutModalCtrl",["$scope",function(a){"use strict";a.time=(new Date).getTime(),a.prettyURL=urls.getHostName(config.url_www)}]),app.controller("FeedbackModalCtrl",["$scope","$jQuery",function(a,b){"use strict";userVoice.getCustomParams(function(c){b.then(function(){a.iframeSource=config.url_feedback+$.param({primary:config.accentColor.substring(1),link:config.themeColor.substring(1),guid:c.guid,data:c.data,forum:c.forum,sid:c.sid}),$("#feedbackFrame").load(function(){$(".feedback-modal .loader").hide()}),_.digest(a)})})}]),app.controller("LoginLogoutModalCtrl",["$scope","$rootScope","$user",function(a,b,c){"use strict";b.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent",config.user?"Logout":"Login","Panel","Cancel"])}),a.logout=function(){b.closeModal(),c.logout()}}]),app.controller("ImageUploadLoginModalCtrl",["$scope","$rootScope",function(a,b){"use strict";b.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Image-Upload-Login","Panel","Cancel"])}),function(){a.numberOfScreenshots=5,a.screenshots=_.range(a.numberOfScreenshots).map(function(a,b){return 4>b?{path:"/img/image-upload/screenshot"+(b+1)+".png"}:{path:"/img/image-upload/screenshot1.png"}})}()}]),app.controller("SettingsModalCtrl",["$scope","$rootScope","$languageManager","$configAPI","$weather","$timeout",function(a,b,c,d,e,f){"use strict";function g(){b.openModal(null,"/app/newtab/partials/modals/SettingsModal.html",null,!0),f(function(){$("#background").click()})}a.settingsMenu=config.settingTabs,a.set=function(a){a=angular.copy(a),configAPI.setMultiple(a)};var h=["default"];_.each(config.themes,function(a){h=_.union(h,[a.settings.bodyClass])}),a.bodyClasses=_.compact(h),a.reportBgChange=function(){bi.report({event_name:"bcg",bcg_event:"change"})},a.CheckTheme=function(a){var b=a.accentColor==config.accentColor&&a.bgColor==config.bgColor&&a.bgFooter==config.bgFooter&&a.bgFooterHeight==config.bgFooterHeight&&a.bgImage==config.bgImage&&a.favoritesBorder==config.favoritesBorder&&a.favoritesMargin==config.favoritesMargin&&a.favoritesOpacity==config.favoritesOpacity&&a.themeColor==config.themeColor;return b},a.$watch("config.selectedLanguage",c.changeLang),a.toggleContentDiscovery=function(b){a.set({enableContentDiscovery:b,contentDiscoveryDisabledTimestamp:b?null:Date.now()})},a.toggleMobileAppsDiscovery=function(b){a.set({enableMobileAppsDiscovery:b,mobileAppsDiscoveryDisabledTimestamp:null})},a.toggleRecentlyClosed=function(b){a.set({enableRecentlyClosed:b})},a.toggleChromeApps=function(b){a.set({enableChromeApps:b})},a.selectImage=function(b,c,e){var g=graphicAssets.isDataURL(b);switch(c){case"backgrounds":if(g)a.config.bgImage=b;else{if(e){var h=a.config.bgImage;graphicAssets.isDataURL(h)&&f(function(){a.config.bgImage=h})}d.set("bgImage",b),a.gae("Settings","background-Image-Selected",b),bi.report({event_name:"bcg",bcg_event:"upload"})}break;case"footers":g?a.config.bgFooter=b:(d.set("bgFooter",b),a.gae("Settings","footer-Image-Selected",b))}},a.removeImage=function(a){var b=a.replace(/^.*[\\\/]/,"").replace(".","");$("#"+b).fadeOut(),bi.report({event_name:"bcg",bcg_event:"remove"})},a.noUserActions=function(){backgroundPage.login.src="background",b.openModal("","/app/newtab/partials/modals/imageUploadLoginModal.html",{onLoginSuccess:function(){b.openModal(null,"/app/newtab/partials/modals/SettingsModal.html",null,!0),config.user&&f(function(){$("#background").click()},300)},onClose:g,onLoginError:g},!0)},a.$on("placeSelected",function(b,c,d){c&&c.geometry&&c.geometry.location&&(e.setLocation({lat:c.geometry.location.lat(),lon:c.geometry.location.lng(),name:d}),_.digest(a)),b.stopPropagation()}),a.$on("GooglePlacesLoaded",function(){utilsAPI.insertCssRules(document,{".pac-item-selected .pac-item-query":{color:"#fff"},".pac-item-selected, .pac-item-selected:hover":{color:"#fff","background-color":config.themeColor+"!important"}})}),a.resetWeatherLocation=function(){a.placeDetails=null,e.setLocation(null)},a.screenShotToggle=function(){a.set({favoritesScreenshots:config.favoritesScreenshots}),a.gae("Settings","Favorites-Screenshots",config.favoritesScreenshots),a.$$phase||a.$apply()},a.currentTime=Date.now()}]),app.controller("TokenExpiredModalCtrl",["$scope","$rootScope","$user",function(a,b,c){"use strict";b.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Token-Expired","Panel","Cancel"])})}]),app.controller("AndroidAppModalCtrl",["$scope","$googlePlayUtils",function(a,b){"use strict";function c(a){bi.report({event_name:"androidinstall",androidinstall_src:"ftue",androidinstall_result:a})}a.appID=a.playUtilsAppID,a.appDetails=!1,a.step=1,a.appID&&$.getJSON("http://api.hoolapp.com/query.php",{type:"apps",items_key:2,output_key:2,items:a.appID},function(b){if(b[a.appID]){a.appDetails=b[a.appID],a.appDetails.stars=[];for(var c=a.appDetails.rating;c>0;c--)a.appDetails.stars.push(c>.5)}else a.detailsError=!0;a.$apply()}),a.doLogin=function(c,d,e){b.googleLogin(c,d,e,function(b){a.messages.push("google Login completed, result "+b),a.playStoreUserResponse(b,c)})},a.confirmInstall=function(c,d,e){a.step=2,a.messages=["--> confirmInstall"],a.messages.push("Installing: ",c),b.isSignedIn()?b.hasDevices()?(a.messages.push("google Login user found, ready to continue"),a.playStoreUserResponse(!0,c)):(a.messages.push("hasDevices FALSE"),a.doLogin(c,d,e)):(a.messages.push("User not logged in to play store, Waiting for login"),a.doLogin(c,d,e))},a.playStoreUserResponse=function(d,e){c("start"),a.messages.push("--> playStoreUserResponse"),d?b.getGoogleAccountData(function(d,e,f){a.messages.push("getGoogleAccountData:",d,e,f),a.messages.push("Installing applications...."),b.doInstall(a.appID,function(b){a.messages.push("Installation completed!"),c(b?"success":"fail"),a.step=b?4:3})}):(a.messages.push("No google Login user found"),a.step=1,c("fail"))}}]),app.controller("DefaultNotificationCtrl",["$scope",function(a){"use strict"}]),app.controller("CallLogNewtabNotificationCtrl",["$scope","$contacts","$call_log","$rootScope","$timeout",function(a,b,c,d,e){"use strict";a.contact={},a.notification.data.from?b.getObject(a.notification.data.from,function(b){a.$$phase||(a.contact=b,a.$apply("contact"))}):"unknown"==a.notification.data.number.toLowerCase()&&(a.notification.data.number="Private Number"),a.showLastConversation=function(a){e(function(){d.showThread(a),c.clearNotificationsForNumber(a)},200)}}]),app.controller("SmsNewtabNotificationCtrl",["$scope","$contacts",function(a,b){"use strict";a.contact=b.getContactByPhoneNumber(a.notification.data.number)}]),app.controller("FtueCtrl",["$scope","$googlePlayUtils",function(a,b){function c(a){bi.report({event_name:"androidinstall",androidinstall_src:"ftue",androidinstall_result:a})}a.isLoading=!1,_gaq.push(["_trackEvent","ftue","step0","view"]),a.moveToNextStep=function(a,b){var c={currentStep:a,nextStep:b};eventManager.dispatchEvent("FTUE","STEP_UPDATE",c),1==b&&(backgroundPage.login.src="ftue")},a.confirmInstall=function(c){_gaq.push(["_trackEvent","ftue","step2","android-installed"]),a.isLoading=!0,a.step=2,a.messages=["--> confirmInstall"],a.messages.push("Installing: ",c),b.isSignedIn()?(a.messages.push("google Login user found, ready to continue"),a.playStoreUserResponse(!0,c)):(a.messages.push("User not logged in to play store, Waiting for login"),b.googleLogin(c,null,null,function(b){a.messages.push("google Login completed, result "+b),a.playStoreUserResponse(b,c)}))},a.playStoreUserResponse=function(d,e){c("start"),a.messages.push("--> playStoreUserResponse"),d?b.getGoogleAccountData(function(d,f,g){a.messages.push("getGoogleAccountData:",d,f,g),b.hasDevices()?(a.messages.push("Installing applications...."),b.doInstall(e,function(b){a.isLoading=!1,eventManager.dispatchEvent("FTUE","SPOTS_ANDROID_INSTALLED"),a.messages.push("Installation completed!"),c(b?"success":"fail")})):(a.messages.push("hasDevices FALSE"),c("fail"))}):(a.messages.push("No google Login user found"),c("fail"))}}]),app.controller("DisableDiscoveryModalCtrl",["$scope","$rootScope",function(a,b){"use strict";a.submitHandler=function(){configAPI.set("enableContentDiscovery",!1),configAPI.set("contentDiscoveryDisabledTimestamp",Date.now()),a.gae("Settings","Discovery-Enabled","Disabled-From-Home"),b.closeModal()}}]),app.controller("DisableMobileAppsModalCtrl",["$scope","$rootScope",function(a,b){"use strict";a.submitHandler=function(){configAPI.set("enableMobileAppsDiscovery",!1),configAPI.set("mobileAppsDiscoveryDisabledTimestamp",Date.now()),a.gae("Settings","Mobile Apps Enabled","Disabled From Home",1),b.closeModal()}}]),app.controller("DiscoveryAddFacebookModalCtrl",["$scope","$rootScope",function(a,b){"use strict";a.facebookLoginPopup=function(){a.$parent.facebookLoginPopup(!0)},a.close=function(a){b.closeModal()}}]),app.controller("DiscoveryAddFacebookNotificationCtrl",["$scope","$rootScope",function(a,b){"use strict";a.facebookLoginPopup=function(){a.$parent.facebookLoginPopup(!0)},a.learnMore=function(){b.openModal(null,"/app/spots/discovery/newtab/partials/modals/DiscoveryAddFacebookModal.html")}}]),app.controller("FacebookRateUsModalCtrl",["$scope","$rootScope",function(a,b){"use strict";if(config.facebookAppID&&config.facebookPage){var c={href:config.facebookPage,width:60,layout:"button",action:"like",show_faces:!1,share:!1,height:35};a.facebookLikeSrc="https://www.facebook.com/plugins/like.php?"+$.param(c)}else config.facebookLikeSrc&&(a.facebookLikeSrc=config.facebookLikeSrc);!function(){var b="/app/spots/facebook/images/carousel/",c=b+"screenshots/";a.imagesPath=b,a.numberOfScreenshots=6,a.screenshotWidth=386,a.screenshots=_.range(a.numberOfScreenshots).map(function(a,b){return{desktop:c+a+".jpg",mobile:c+a+"-mobile.jpg"}}),a.screenshots.push(_.extend({},a.screenshots[0])),a.numberOfScreenshots+=1}(),_gaq.push(["_trackEvent","facebook-modal","view"]),b.modalHandlers.onClose.add(function(){configAPI.set("facebookRateUsModalDisplayed",!0),configAPI.remove("showFacebookRateUsModal"),_gaq.push(["_trackEvent","facebook-modal","close"])})}]),app.controller("FavoritesAddModalCtrl",["$scope","$rootScope","$favorites",function(a,b,c){"use strict";function d(){b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesAddModal.html",null,!0)}a.newFav=b.favBeforLogin?angular.copy(b.favBeforLogin):{iconSize:config.favoritesIconSize},b.favBeforLogin=null,a.isDisabled=!0,a.colorPalette=null,a.showLoader=!1,a.selectedCat=b.newFavCategory,c.getFavorites(function(b){a.directory=b.DIRECTORY.directory}),a.saveCategory=function(d){a.selectedCat!=b.newFavCategory?c.changeItemCategory(a.newFavCategory,a.selectedCat,d):d()},a.updateFavData=function(b){b&&(a.newFav.icon=null,a.newFav=_.extend(a.newFav,_.pick(b,"color","icon")),a.newFav.title=b.title?b.title:a.newFav.title,a.colorPalette={},a.colorPalette[b.color]=_.union(b.picker,[b.color]),_.digest(a))},a.urlChange=_.debounce(function(b){urls.isValidUrl(b)?(a.isDisabled=!1,a.showLoader=!0,a.defaultTitle="",_.digest(a),webScrapper.scrape(b,["gallery","meta","webColorPicker"]).progress(a.updateFavData).done(function(b){a.updateFavData(b),a.defaultTitle=b&&b.title,a.showLoader=!1,_.digest(a)})):(a.isDisabled=!0,0===b.length&&(a.newFav.title=null,a.newFav.icon=null),_.digest(a))},300),a.$watch("newFav.url",function(b){a.isDisabled=!urls.isValidUrl(b)}),a.getBaseDomain=function(a){return urls.getBaseDomain(a,!0)},b.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Fav-Add","cancel"])}),a.selectImage=function(b){graphicAssets.isDataURL(b)||(a.newFav.userIcon=b,_.digest(a),bi.report({event_name:"icon",icon_event:"upload"}))},a.removeImage=function(a){var b=a.replace(/^.*[\\\/]/,"").replace(".","");$("#"+b).css("background-image","none"),bi.report({event_name:"icon",icon_event:"remove"})},a.submitHandler=function(){urls.isValidUrl(a.newFav.url)&&(a.newFav.title||(a.newFav.title=a.defaultTitle||a.getBaseDomain(a.newFav.url)),_gaq.push(["_trackEvent","Favorite","Fav-Add","Save"]),_gaq.push(["_trackEvent","Favorite","Add-Name",a.newFav.title]),_gaq.push(["_trackEvent","Favorite","Add-URL",a.newFav.url]),c.addItem(a.newFav,a.selectedCat,function(){bi.report({event_name:"fav",fav_event:"add",fav_domain:urls.getHostName(a.newFav.url,!1)}),b.closeModal(!1),_.digest(a)}))},a.noUserActions=function(){backgroundPage.login.src="icon",b.openModal("","/app/newtab/partials/modals/imageUploadLoginModal.html",{onLoginSuccess:function(){b.favBeforLogin=a.newFav,b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesAddModal.html",null,!0)},onClose:d,onLoginError:d},!0)}}]),app.controller("FavoritesCategoriesAddModalCtrl",["$scope","$favorites","$rootScope",function(a,b,c){"use strict";c.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Category-Add","cancel"])}),a.submitHandler=function(){a.categoryName.length&&(_gaq.push(["_trackEvent","Favorite","Category-Add","Save"]),_gaq.push(["_trackEvent","Favorite","Category-Add-Name",a.categoryName]),b.addCategory(a.categoryName,function(){c.closeModal(!1)}))}}]),app.controller("FavoritesCategoriesDeleteModalCtrl",["$scope","$favorites","$rootScope",function(a,b,c){"use strict";c.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Category-Delete","cancel"])}),a.submitHandler=function(){_gaq.push(["_trackEvent","Favorite","Category-Delete","Yes"]),_gaq.push(["_trackEvent","Favorite","Category-Delete-Name",c.catDeleteID]),b.removeCategory(c.catDeleteID,function(){c.closeModal(!1)})}}]),app.controller("FavoritesCategoriesEditModalCtrl",["$scope","$favorites","$rootScope",function(a,b,c){"use strict";c.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Category-Edit","cancel"])}),a.submitHandler=function(){c.catEditItem.name&&c.catEditItem.name.length&&(_gaq.push(["_trackEvent","Favorite","Category-Edit","Save"]),_gaq.push(["_trackEvent","Favorite","Category-Edit-Name",c.catEditItem.name]),b.editCategory(c.catEditItem,function(){c.closeModal(!1),_.digest(a)}))}}]),app.controller("FavoritesDeleteModalCtrl",["$scope","$favorites","$rootScope",function(a,b,c){"use strict";c.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Favorite-Delete","cancel"])}),a.submitHandler=function(){_gaq.push(["_trackEvent","Favorite","Favorite-Delete","Yes"]),b.getItem(c.favDeleteItemID,function(d){b.removeItem(c.favDeleteItemID,function(){bi.report({event_name:"fav",fav_event:"remove",fav_domain:urls.getHostName(d.url,!1)}),a.closeModal(!1)})})}}]),app.controller("FavoritesEditModalCtrl",["$scope","$rootScope","$favorites",function(a,b,c){"use strict";function d(){b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesEditModal.html",null,!0)}a.favEditItem=b.favBeforLogin?angular.copy(b.favBeforLogin):a.favEditItem,a.favEditItem.iconSize=a.favEditItem.iconSize?a.favEditItem.iconSize:config.favoritesIconSize,b.favBeforLogin=null;var e=a.favEditItem.id;a.colorPalette=null,a.showLoader=!1,a.selectedCat=b.catEditItem.id,c.getFavorites(function(b){a.directory=b.DIRECTORY.directory}),a.saveCategory=function(d){a.selectedCat!=b.catEditItem.id?c.changeItemCategory(a.favEditItem.id,a.selectedCat,d):d()},a.updateFavData=function(b){b&&(a.favEditItem.icon=null,a.favEditItem=_.extend(a.favEditItem,_.pick(b,"color","icon")),a.favEditItem.title=b.title||a.favEditItem.title,a.colorPalette={},a.colorPalette[b.color]=_.union(b.picker,[b.color]),_.digest(a))},a.urlChange=_.debounce(function(b){urls.isValidUrl(b)?(a.isDisabled=!1,a.showLoader=!0,a.defaultTitle="",_.digest(a),webScrapper.scrape(b,["gallery","meta","webColorPicker"]).progress(a.updateFavData).done(function(b){a.updateFavData(b),a.defaultTitle=b&&b.title,a.showLoader=!1,_.digest(a)})):(a.isDisabled=!0,0===b.length&&(a.favEditItem.title=null,a.favEditItem.icon=null),_.digest(a))},300),a.$watch("favEditItem.url",function(b){a.isDisabled=!urls.isValidUrl(b)}),a.getBaseDomain=function(a){return urls.getBaseDomain(a,!0)},b.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","Fav-Add","cancel"])}),a.selectImage=function(b,c,d,e){e=_.verifyCallback(e),graphicAssets.isDataURL(b)||(a.favEditItem.userIcon=b,_.digest(a),bi.report({event_name:"icon",icon_event:"upload"}),e())},a.removeImage=function(a){var b=a.replace(/^.*[\\\/]/,"").replace(".","");$("#"+b).css("background-image","none"),bi.report({event_name:"icon",icon_event:"remove"})},a.submitHandler=function(){urls.isValidUrl(a.favEditItem.url)&&(a.favEditItem.title||(a.favEditItem.title=a.defaultTitle||a.getBaseDomain(a.favEditItem.url)),_gaq.push(["_trackEvent","Favorite","Fav-Edit","Save"]),_gaq.push(["_trackEvent","Favorite","Edit-Name",a.favEditItem.title]),_gaq.push(["_trackEvent","Favorite","Edit-URL",a.favEditItem.url]),a.favEditItem.id=e,c.editItem(a.favEditItem,function(){a.saveCategory(function(){b.closeModal(!1)}),_.digest(a)}))},a.noUserActions=function(){backgroundPage.login.src="icon",b.openModal("","/app/newtab/partials/modals/imageUploadLoginModal.html",{onLoginSuccess:function(){b.favBeforLogin=a.favEditItem,b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesEditModal.html",null,!0)},onClose:d,onLoginError:d},!0)}}]),app.controller("FavoritesNewtabCtrl",["$scope","$rootScope","$favorites","$timeout","$spotsManager","$jQuery",function(a,b,c,d,e,f){"use strict";function g(a,b,c){var d=config.favoritesSections;b?d.indexOf(a)<0&&(d.splice(c||0,0,a),configAPI.set("favoritesSections",d)):configAPI.set("favoritesSections",_.without(d,a))}time.start("FavoritesNewtabCtrl-rendering"),d(function(){time.end("FavoritesNewtabCtrl-rendering")}),b.loadedSections={top_sites:!0,favorites:!0,discovery:!1,mobile_apps:!1},a.sections=_.extend({top_sites:{report:"MV",label:"top_sites",partial:"/app/spots/favorites/newtab/partials/MostVisited.html"},favorites:{report:"F",label:"favorites",partial:"/app/spots/favorites/newtab/partials/FavoritesView.html"},discovery:{report:"D",label:"discovery",partial:"/app/spots/discovery/newtab/partials/NewtabDiscovery.html"}},config.favoritesExtraSections),a.moveSection=function(b,c){var e=config.favoritesSections,f=_.indexOf(e,b),g="up"===c?f-1:f+1;if(f>=0&&f<=e.length){var h=e[f];e[f]=e[g],e[g]=h,configAPI.set("favoritesSections",e),utilsAPI.sendGA("Categories","Reorder",_.map(config.favoritesSections,function(b){return a.sections[b].report}).join("-")),d(function(){a.scrollToSection(b)},100)}},a.categoriesSortableOptions={axis:"y",distance:5,revert:300,handle:".category-header .draggable",start:function(a,b){$("ul.items",b.helper).slideUp(300)},beforeStop:function(a,b){$("ul.items",b.helper).delay(300).slideDown(300)}},a.scrollToSection=function(a){d(function(){$("#fa").find(".favorites-container").animate({scrollTop:$($(".favorites-container #"+a)[0]).offset().top+$(".favorites-container").scrollTop()-100},500)},50)},a.itemsSortableOptions={connectWith:"ul.items",cancel:"li.add-item",items:"li:not(.add-item)",cursor:"move",revert:300,distance:5,update:_.debounce(function(a,b){c.directorySave()},100),sort:function(a,b){var c=90*-(b.helper.position().left/window.innerWidth-.5);b.helper.css("-webkit-transform","perspective(500px) rotateY("+c+"deg)")},change:function(a,b){b.placeholder.is(":last-child")&&b.placeholder.insertBefore(b.placeholder.siblings(".add-item"))},start:function(b,c){c.placeholder.css("width",a.elementsStyle.item.width)},beforeStop:function(a,b){b.helper.css("-webkit-transform","perspective(500px) rotateY(0deg)")}},a.$watchCollection(function(){return[config.bgFooterHeight,config.bgFooter,config.colorScheme,config.navbarOpacity,config.favoritesMargin,config.favoritesBorder,config.favoritesOpacity,config.favoritesShadow,config.themeColor]},function(){a.elementsStyle={categories:{background:graphicAssets.hexToRgba("light"===config.colorScheme?"#ffffff":"#000000",config.navbarOpacity/1.5)},items:{margin:"0 -"+config.favoritesMargin+"px"},item:{width:100/Math.round(window.innerWidth/333)+"%",padding:config.favoritesMargin/2+"px"},itemCnt:{"border-width":config.favoritesBorder,background:"rgba(255,255,255,"+config.favoritesOpacity+")","box-shadow":"1px 3px 5px rgba(0, 0, 0, "+config.favoritesShadow+")"},addItemIcon:{"background-color":config.themeColor},addItemTitle:{color:config.themeColor}}}),a.$watch("config.topSitesItems",function(){g("top_sites",parseInt(config.topSitesItems,10)>0)}),a.$watch("config.enableContentDiscovery",function(){var a=!!config.enableContentDiscovery,b=config.favoritesSections.indexOf("favorites");g("discovery",a,0>b?0:b)}),a.$watch("config.enableMobileAppsDiscovery",function(){var a=config.mobileAppsDiscoveryAvailable&&config.enableMobileAppsDiscovery,b=config.favoritesSections.indexOf("top_sites");g("mobile_apps",a,0>b?0:b+1)}),a.numOfCategoriesToDisplay=100,a.calculateCategories=_.throttle(function(){d(function(){if(window.$){var b=$(".categories-bar"),c=$(".category-group:first-child .category-title"),d=b.width()-$(".category-group:last-child").width()-150,e=b.find(".add-category, .default-category"),f=0,g=0;e.each(function(){g+=$(this).width()}),c.each(function(){var a=$(this).width();a>0&&(g+=a,d>g&&f++)}),a.numOfCategoriesToDisplay=f}})},200),a.openArrayOfFavorites=function(b){var c=[];_.each(b,function(b){c.push(a.favorites[b])}),a.openArrayOfItems(c)},a.openArrayOfItems=function(a){_.each(a,function(a){a.url&&window.open(urls.getFullURL(a.url),"_blank")})},a.getChromeApps=function(){a.chromeApps||chromeapps.getChromeApps(function(b){a.chromeApps=b,_.digest(a)})},a.getRecentlyClosed=function(){recent_sites.getItems(50,function(b){a.recentlyClosed=b,_.digest(a)})},a.addFavorite=function(a){utilsAPI.sendGA("Favorite","Fav-Add","Click"),b.newFavCategory=a,b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesAddModal.html")},a.editFavorite=function(a,c){utilsAPI.sendGA("Favorite","Fav-Edit","Click"),b.favEditItem=angular.copy(a),b.catEditItem=angular.copy(c),b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesEditModal.html")},a.removeFavorite=function(a){utilsAPI.sendGA("Favorite","Fav-Remove","Click"),b.favDeleteItemID=a,b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesDeleteModal.html")},a.removeTopSite=function(b){utilsAPI.sendGA("Favorite","Remove-Top-Site","Click");var c=config.mostVisitedHideList;c.push(b.url),configAPI.set("mostVisitedHideList",c),a.refreshTopSites(),_.digest(a)},a.addCategory=function(){utilsAPI.sendGA("Favorite","Category-Add","Click"),b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesCategoriesAddModal.html")},a.editCategory=function(a){utilsAPI.sendGA("Favorite","Category-Edit","Click"),b.catEditItem=angular.copy(a),b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesCategoriesEditModal.html")},a.removeCategory=function(a){utilsAPI.sendGA("Favorite","Category-Remove","Click"),b.catDeleteID=a,b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesCategoriesDeleteModal.html")},a.removeTopSites=function(){utilsAPI.sendGA("Favorite","TopSites-Hide-All","Click"),b.openModal("","/app/spots/favorites/newtab/partials/modals/FavoritesRemoveTopSitesModal.html")},a.refreshTopSites=function(){a.topSitesItems=_.first(a.topSites,Number(config.topSitesItems)+config.mostVisitedHideList.length)},a.launchApp=function(a){chromeapps.launchApp(a)},a.reportClick=function(a){bi.report({event_name:"fav",fav_event:"click",fav_domain:urls.getHostName(a.url,!0)})},jqLite(window).on("resize",_.throttle(function(){a.elementsStyle.item.width=100/Math.round(window.innerWidth/333)+"%",_.digest(a),a.calculateCategories()},100)),a.$on(e.spotID("favorites")+"_FAVORITES_EVENT",function(b,c){switch(c.type){case"UPDATE":a.favorites=c.data,a.directory=c.data.DIRECTORY.directory,a.calculateCategories();break;case"ITEM_ADDED":c.data.id&&(a.favorites[c.data.id]=c.data);break;case"ITEM_UPDATED":c.data.id&&(a.favorites[c.data.id]=c.data);break;case"ITEM_REMOVED":delete a.favorites[c.data];break;case"DIRECTORY_UPDATE":a.directory=c.data,a.calculateCategories();var d=$(".category-title").map(function(){return $(this).attr("id")}),e=_.map(a.directory,function(a){return"cat_"+a.id});_.each(_.difference(d,e),function(a){$(".category-title#"+a).remove()})}_.digest(a)}),a.topSites=new Array(Number(config.topSitesItems)),topsites.getTopSites(20,_.throttle(function(b){a.topSites=b,a.refreshTopSites(),a.$watch("config.topSitesItems",a.refreshTopSites),a.calculateCategories(),time.end("getTopSites")},2e3)),time.start("getFavorites"),c.getFavorites(function(b){a.favorites={},_.each(b,function(b){"DIRECTORY"==b.id?a.directory=b.directory:favorites.enrichItem(b)}),a.calculateCategories(),time.end("getFavorites")}),f.then(function(){function b(){var a=$(".favorites-container"),b=window.innerWidth/window.screen.width*Number(config.bgFooterHeight),c=a[0].scrollHeight,d=a.height(),f=0;if(c>d){var g=(c-a[0].scrollTop)/d;f=b*(1-g)+"px"}a.css("background-position","center bottom "+f),e.css("padding-bottom",b)}var c=$(".favorites-container"),e=c.find(".sections-container");c.scroll(b),$(window).on("resize",b),a.$watch("config.bgFooterHeight",b),d(b)})}]),app.directive("hightlightSection",["$jQuery",function(a){return{compile:function(){function b(a){$(a.target).closest(".section-container")["mouseover"===a.type?"addClass":"removeClass"]("hover")}function c(a){$(".section-container").removeClass("hover")}return function(d,e,f){a.then(function(){e.on("mouseover mouseout",b),e.on("click",c)})}}}}]),app.controller("FavoritesRemoveTopSitesModalCtrl",["$scope","$favorites","$rootScope",function(a,b,c){"use strict";c.modalHandlers.onClose.add(function(){_gaq.push(["_trackEvent","Favorite","TopSites-Hide-All","cancel"])}),a.submitHandler=function(){_gaq.push(["_trackEvent","Favorite","TopSites-Hide-All","Yes"]),configAPI.set("topSitesItems",0),c.closeModal(!1)}}]),app.controller("NewtabClockCtrl",["$scope","$timeout",function(a,b){"use strict";a.updateClock=function(){a.currentTime=(new Date).getTime(),b(a.updateClock,ONE_MINUTE)},a.updateClock()}]),app.controller("NewtabContactsSearchResultCtrl",["$rootScope","$scope","$spotsManager","$pushService","$contacts","$timeout",function(a,b,c,d,e,f){b.currentView="default",b.$watch("enterEventInfo",function(){b.enterEventInfo&&b.enterEventInfo.spotID==spotsManager.spotID("contacts")&&b.enterEventInfo.selectedItem==b.$index&&b.openThread(b.getDefaultPhone(b.result))}),b.getDefaultPhone=function(a){return e.getContactDefaultPhone(a)},b.openThread=function(c){f(function(){_gaq.push(["_trackEvent","Search","Contacts-Search","Message-Contact"]),a.setSearchTerm(null),a.showThread(c),b.clickedOutside()})},b.toggleContact=function(){b.disableToggle||("all_numbers"==b.currentView?b.currentView="default":(b.currentView="all_numbers",_gaq.push(["_trackEvent","Search","Contacts-Search","AutoComplete-Click"])))},b.callDialedHandler=function(){b.selectedItemCallItem==b.$index&&(b.currentView="call_connected",f(function(){b.currentView="default",b.$$phase||b.$apply("currentView")},5e3),eventManager.removeEventListener(c.spotID("call_log"),4,b.callDialedHandler))},b.callNumber=function(a){b.selectedItem==b.$index&&(b.selectedItemCallItem=b.selectedItem,_gaq.push(["_trackEvent","Search","Contacts-Search","Call-Contact"]),b.currentView="calling",b.$$phase||b.$apply("currentView"),d.sendNotification(c.spotID("call_log"),1,{number:a,speaker:config.phoneSpeaker},function(){}),b.$on(c.spotID("call_log")+"_4",b.callDialedHandler))},b.cancelCall=function(){_gaq.push(["_trackEvent","Search","Contacts-Search","Cancel-Call-Contact"]),b.currentView="default",d.sendNotification(c.spotID("call_log"),2,""),eventManager.removeEventListener(c.spotID("call_log"),4,b.callDialedHandler)}}]),app.controller("NewtabDiscoveryCtrl",["$scope","$rootScope",function(a,b){"use strict";a.isLiked=function(a){return a&&a.id in discovery.moreLikeThisItems},a.itemClicked=function(b){var c=_.capitalize(config.discoveryItemsSize);a.gae("Discovery","Click-"+c,b.analyticsLabel,1),a.gae("Discovery","Click-URL",b.url,1)},a.toggleHover=function(){var a=$(".discovery-items .context-menu:hover").css("pointer-events","none");setTimeout(function(){a.css("pointer-events","auto")})},a.openContextMenu=function(a){$(a.currentTarget).toggleClass("open")},discovery.getFeed(function(c){a.allItems=_(c).groupBy("paid").zip().flatten().compact().value(),a.itemLimit=10,b.loadedSections.discovery=!0,a.gae("Discovery","Loaded",config.discoveryItemsSize,1),_.digest(a)}),a.disableContentDiscovery=function(){a.openModal("disable_discovery","/app/spots/discovery/newtab/partials/modals/DisableDiscoveryModalCtrl.html")},a.feedback=function(b,c,d){switch(a.gae("Discovery","Click-"+_.capitalize(b),c.url,1),b){case"more":break;case"less":a.allItems=_.reject(a.allItems,{id:c.id}),a.items.splice(d,1);var e=_.first(_.difference(a.allItems,a.items));e&&a.items.splice(d,0,e);break;case"hide":a.allItems=_.reject(a.allItems,{source:c.source}),a.items=_.reject(a.items,{
source:c.source});var f=_.first(_.difference(a.allItems,a.items),a.itemLimit-a.items.length);a.items=a.items.concat(f);break;case"report":}discovery.feedback(b,c,d)},a.$watch("itemLimit",function(){a.allItems&&a.itemLimit&&(a.items=_.first(a.allItems,a.itemLimit))}),jqLite(document).on("click",function(a){$(".context-menu.open").not($(a.target).closest(".context-menu")).removeClass("open")})}]),app.controller("NewtabFavoritesSearchResultCtrl",["$scope",function(a){"use strict";var b={bookmarks:"Bookmarks-Search",favorites:"Favorites-Search","top-sites":"TopSites-Search","chrome-apps":"ChromeApps-Search"};a.resultClick=function(){utilsAPI.sendGA("Search",b[a.spot.type]||"","AutoComplete-Click",null);var c={"TopSites-Search":"mostvisited","Favorites-Search":"fav","Web-Search":"web","Contacts-Search":"contact","Bookmarks-Search":"bkmark"};bi.report({event_name:"srch",srch_provider:urls.getBaseDomain(config.searchProviderUrl).split(".").pop(),srch_type:c[b[a.spot.type]]}),"chrome-apps"===a.spot.type?chromeapps.launchApp(a.result):a.$parent.resultClick(a.result.url)},a.$watch("enterEventInfo",function(){a.enterEventInfo&&a.enterEventInfo.spotID==spotsManager.spotID("favorites")&&a.enterEventInfo.selectedItem==a.$index&&a.enterEventInfo.type==a.spot.type&&a.resultClick()})}]),app.controller("NewtabGameoSearchResultCtrl",["$rootScope","$scope",function(a,b){function c(a,b,c){return c.replace(new RegExp(a,"g"),b)}b.resultClick=function(){var a=c(" ","-",b.result.title),d=config.gameoSearchResultAdress.replace("%GAME_TITLE%",a).replace("%GAME_ID%",b.result.id).replace("%LABEL_NAME%",config.brand);b.$parent.resultClick(d)},b.$watch("enterEventInfo",function(){b.enterEventInfo&&b.enterEventInfo.spotID==spotsManager.spotID("gameo")&&b.enterEventInfo.selectedItem==b.$index&&b.resultClick()})}]),app.controller("NewtabMobileAppsCtrl",["$scope","$rootScope",function(a,b){"use strict";function c(){mobileApps.getFeed(function(c){a.allItems=_.shuffle(c),a.itemLimit=10,a.gae("Mobile Apps","Show",null,1),b.loadedSections.mobile_apps=!0,_.digest(a)})}a.itemClicked=function(a){_.capitalize(config.mobileAppsItemsSize);_.verifyCallback(a.onClick)(a)},a.$watch("itemLimit",function(){a.allItems&&a.itemLimit&&(a.items=_.first(a.allItems,a.itemLimit))}),a.disableMobileApps=function(){a.openModal("disable_mobile_apps","/app/spots/mobile-apps/newtab/partials/modals/DisableMobileAppsModal.html")},c()}]),app.controller("NewtabReviewCtrl",["$rootScope","$scope",function(a,b){b.reviewClass="cat",b.hoveredStar=5,b.selectedStar=5,b.stars=[1,2,3,4,5],b.isFinished=!1;var c={insert_date:Date.now(),action:"view"};configAPI.set("reviewInfo",utilsAPI.encrypt(JSON.stringify(c))),analytics.reportEvent("reviews","view"),analytics.reportEvent("reviews-android","view"),b.publishReview=function(){var a=b.selectedStar,c=b.reviewComment?b.reviewComment:"",d={insert_date:Date.now(),action:"publish",rating:a};analytics.reportEvent("reviews","publish-"+a,c),backgroundPage.reviewAPI.rate(a,c),config.InstalledAndroidApp?googlePlayUtils.sendReview(a,c,function(b,e){b?(d.androidReviewSent=!0,analytics.reportEvent("reviews-android","publish-"+a,c)):analytics.reportEvent("reviews-android",e),configAPI.set("reviewInfo",utilsAPI.encrypt(JSON.stringify(d)))}):(analytics.reportEvent("reviews-android","no-android"),configAPI.set("reviewInfo",utilsAPI.encrypt(JSON.stringify(d)))),b.isFinished=!0},b.close=function(b){configAPI.set("remoteReviewClosed",!0),eventManager.dispatchEvent("MODAL","CLOSE_MODAL"),b&&(analytics.reportEvent("reviews","cancel"),analytics.reportEvent("reviews-android","cancel")),a.closeModal(!1)},a.modalHandlers.onClose.add(function(){var a=utilsAPI.encrypt(JSON.stringify({insert_date:Date.now(),action:"cancel"}));configAPI.set("reviewInfo",a),configAPI.set("remoteReviewClosed",!0),eventManager.dispatchEvent("MODAL","CLOSE_MODAL")})}]),app.controller("NewtabSearchResultCtrl",["$scope",function(a){"use strict";var b={calculator:"Calculator-Search",navigation:"Navigation-Search","web-search":"Web-Search"};a.resultClick=function(){utilsAPI.sendGA("Search",b[a.spot.type]||"","AutoComplete-Click",null),("web"===a.result.type||"web-default"===a.result.type)&&utilsAPI.sendGA("Search-Term",a.searchTerm,"",null),"calculator"===a.spot.type&&(a.result.value=a.buildGoogleSearchURL(a.searchTerm)),a.$parent.resultClick(a.result.value)},a.$watch("enterEventInfo",function(){a.enterEventInfo&&a.enterEventInfo.spotID==spotsManager.spotID("search")&&a.enterEventInfo.selectedItem==a.$index&&a.enterEventInfo.type==a.spot.type&&a.resultClick()})}]),app.controller("NewtabWeatherCtrl",["$scope",function(a){"use strict";function b(){return weather.getWeather().then(function(b){var c=b.weather;c.length&&(a.weatherConditionText=c[0].description,a.weatherConditionId=c[0].id),a.temperature=Math.round(b.main.temp),_.digest(a)})}a.weatherLoaded=!1,b().then(function(){a.weatherLoaded=!0},function(){a.unavailable=!0}),a.$on("SETTINGS_LANGUAGE_CHANGED",b),a.$watch("config.weatherLocation",b),window.setInterval(b,weather.getRefreshInterval())}]),app.filter("multiSearchFilter",[function(){return function(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=0;f<c.length;f++){var g;if(-1!==c[f].indexOf(".")){if(g=c[f].substring(0,c[f].indexOf(".")),void 0!==a[e][g]&&void 0!==b)for(var h in a[e][g])-1!==a[e][g][h].toLowerCase().indexOf(b.toLowerCase())&&(checkIfArrayHasObject(d,a[e].id)||d.push(a[e]))}else void 0!==a[e][c[f]]&&void 0!==b&&-1!==a[e][c[f]].toLowerCase().indexOf(b.toLowerCase())&&(checkIfArrayHasObject(d,a[e].id)||d.push(a[e]))}return d}}]),app.controller("SearchCtrl",["$scope","$rootScope","$dynamicCSS","$favorites","$gallery","$spotsManager","$idb",function(a,b,c,d,e,f,g){"use strict";a.searchType="web",a.spotsResults=null,a.smsResults=[],a.callLogResults=[],a.productsResults=[],b.doSearch=function(c){_gaq.push(["_trackEvent","Search","Submit",c]),a.searchResults=null,a.spotsResults=null,a.smsResults=[],a.contactsResults=[],a.$$phase||a.$apply(),b.q&&(a.doWebSearch(),a.getSmsResults(),a.getContactsResults(),a.getProductsResults(b.q))},_.each(f.getSpots(),function(b){b.searchable&&(a[b.name]=window[b.name])}),a.doWebSearch=function(){a.searchAjax&&a.searchAjax.abort(),a.searchAjax=$.ajax({type:"GET",url:"http://start.mysearchdial.com/results.php",data:{a:"spts1201",q:b.q,category:a.searchResults},success:function(b){function c(c,e,f){var g=$(b).find('ResultSet[id="'+c+'"]').find("Listing");f&&(g=g.slice(0,f)),g.each(function(b){var c=$(this).attr("siteHost");a.searchResults.push({sponsored:e,showImage:e?e:3>b,title:$(this).attr("title"),description:$(this).attr("description"),normalizedUrl:/(http(s)?):\/\/.+/.test(c)?c:"http://"+c,siteHost:$(this).attr("siteHost"),ClickUrl:$(this).find("ClickUrl").text(),isAdded:d.reverseMatch(c).length>0?!0:!1})})}a.NextArgs=$(b).find("NextArgs").text(),a.PrevArgs=$(b).find("PrevArgs").text(),a.TotalHits=$(b).find("TotalHits").text(),a.searchResults=[],c("searchResults",!0,2),c("inktomi",!1),a.searchAjax=null,a.$$phase||a.$apply()}})},a.loadNextWebSearch=function(){a.searchAjax||(a.searchAjax=$.ajax({type:"GET",url:"http://start.mysearchdial.com/results.php",data:{a:"spts1201",q:b.q,hData:a.NextArgs},success:function(b){$(b).find("Listing").each(function(){var b=$(this).attr("siteHost");a.searchResults.push({title:$(this).attr("title"),description:$(this).attr("description"),normalizedUrl:/(http(s)?):\/\/.+/.test(b)?b:"http://"+b,siteHost:b,ClickUrl:$(this).find("ClickUrl").text(),isAdded:d.reverseMatch(b).length>0?!0:!1})}),a.searchAjax=null}}))},a.setSearchType=function(c){a.searchType=c,a.doSearch(b.q)},a.toggleFavorite=function(b){var c=new RegExp(b.normalizedUrl),f=d.reverseMatch(c);if(f.length>0)_.each(f,function(c){d.removeFavorites([c.id],function(){b.isAdded=!1,a.$apply()})});else{var g={url:b.normalizedUrl,title:b.title.replace(/<(?:.|\n)*?>/gm,"")};e.updateFavItemByDomain(b.normalizedUrl,g),d.addItem(g,null,function(){b.isAdded=!0,a.$apply()})}},b.getContrast=function(a){return c.contrast(a)},a.openWebLink=function(a,b){b?_gaq.push(["_trackEvent","Search","Click-Paid",a]):_gaq.push(["_trackEvent","Search","Click-Organic",a]),window.location.href=a},a.getSmsResults=function(){sms.getAllObjectsArray(function(b){a.smsResults=b,a.$$phase||a.$apply()})},a.getProductsResults=function(b){products.fetchResults(b,function(b){a.productsResults=b})},a.getContactsResults=function(){contacts.getAllObjectsArray(function(b){a.contactsResults=b,a.$$phase||a.$apply()})}}]),app.directive("webSearchResults",[function(){return{restrict:"A",link:function(a,b){b.ready(function(){b.scroll(function(){$(b).scrollTop()>$(b).prop("scrollHeight")-$(b).height()-100&&a.loadNextWebSearch()})})}}}]);var ONE_SECOND=1e3,ONE_MINUTE=60*ONE_SECOND,ONE_HOUR=60*ONE_MINUTE,ONE_DAY=24*ONE_HOUR,ONE_WEEK=7*ONE_DAY;!function(){"use strict";window.jqLite=window.$||function(){var a=/^(?:\s*<[\w\W]+>)[^>]*$/;return function(b){var c=Array.prototype.slice.call(arguments);return"string"!=typeof b||a.test(b)||(c[0]=document.querySelectorAll(b)),angular.element.apply(angular,c)}}();var a=function(a){chrome.runtime.getBackgroundPage(function(b){window.backgroundPage=b,window.configAPI=backgroundPage.configAPI,window.config=configAPI.getConfig(),window.moment=backgroundPage.moment,window.getUUID=backgroundPage.getUUID,config.bgImage?jqLite(document.body).css("background-image",config.bgImage):jqLite(document.body).css("background-color",config.bgColor),chrome.tabs.getCurrent(function(b){window.tabID=b.id,window.time=function(a){var b=getUUID();return{getActionLog:a.getActionLog,start:function(c,d){return"string"!=typeof c||d||(c=c+"_"+b),a.start(c,"Newtab")},end:function(c,d){return"string"!=typeof c||d||(c=c+"_"+b),a.end(c,"Newtab")}}}(backgroundPage.time),time.start("-----------------------------").end(),a()})})},b=function(a){config.backgroundInitialized.done(function(){var b=/module\.|_service|\.js/gi,c=_.flatten(_.map(backgroundPage.spotsManager.getSpotsArray(),function(a){return _.map(a.background_scripts,function(a){return a.replace(b,"")})})),d=_.flatten([c,config.module_import_list]);_.each(d,function(a){var b=backgroundPage[a]||backgroundPage[_.camelCase(a)];b&&(window[a]=b,app.factory("$"+a,function(){return window[a]}))}),moment.lang(languageManager.getLang()),a()})},c=function(a){_gaq.push(["_trackEvent","Newtab","Init-Complete"]),time.start("MainCtrl"),time.start("App Creation"),document.title=languageManager.getTranslation("newtab"),angular.bootstrap(document,["spotsNewtab"],{strictDi:!0}),a()};async.series([a,function(a){time.start("loadApp"),a()},b,function(a){time.end("importBgServices"),time.start("loadControllersAndExports"),a()},c,function(a){time.end("bootstrap"),a()}],function(){})}();